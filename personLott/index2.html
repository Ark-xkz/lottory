<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="X-UA-Compatible" content="ie=edge">
	<title>Lottery</title>
	<link rel="stylesheet" href="css/base.css" type="text/css">
	<style type="text/css">
		#lottery {
			width: 644px;
			height: 644px;
			margin: 100px auto 0;
		}
		.turn_1, .turn_2, .turn_3, .turn_4, .turn_5, .turn_6, .turn_7, .turn_8, .turn_0 {
			width: 208px;
			height: 208px;
			float: left;
			position: relative;
		}
		.turn_5, .turn_6, .turn_8, .turn_0, .turn_2, .turn_3 {
			margin-right: 10px;
		}
		.turn_8, .turn_0, .turn_1, .turn_2, .turn_3, .turn_4 {
			margin-top: 10px;
		}
		.lottery-unit img {
			width: 208px;
			height: 208px;
		}
		.active .mask {
			display: block;
		}
		.mask {
			width: 100%;
			height: 100%;
			position: absolute;
			top: 0;
			left: 0;
			background: url(images/turn_active.png) no-repeat;
			display: none;
		}
		.rand_btn {
			margin: 0px auto auto auto;
			display: block;
			width: 40px;
			height: 40px;
			background: url(images/lottery.png) no-repeat;
			background-size: 40px 40px;
			text-align: center bottom;
		}
		.div-text {
			width: 644px;
			height: 644px;
			margin: 100px auto 0;
			font-size: 20px;
		}
		.text_1, .text_2, .text_3, .text_4, .text_5, .text_6, .text_7, .text_8, .text_0  {
			width: 208px;
			height: 208px;
			float: left;
			position: relative;
		}
		.text_5, .text_6, .text_8, .text_0, .text_2, .text_3 {
			margin-right: 10px;
		}
		.text_8, .text_0, .text_1, .text_2, .text_3, .text_4 {
			margin-top: 10px;
		}
		#big-block {
			margin:0 auto;
			width:644px
		}
	</style>
</head>
<body background=images/673598.jpg >
<!-- <a class="rand_btn" onclick="scratchableLatex.init()"></a> -->
<a class="rand_btn" href="javascript:scratchableLatex.init()"></a>
<div style="z-index:100">
	<a style="background-color:transparent; border:0; font-size:30px" id="set-button"  href="javascript:set()" >设置</a>
</div>
	<div id="big-block" style="position:relative">
		<div style="position:absolute; ">
			<ul id="lottery" class="clearfix">
				<li class="lottery-unit turn_5">
					<img src="images/gift2.png">
					<div class="mask"></div>
				</li>
				<li class="lottery-unit turn_6">
					<img src="images/gift2.png">
					<div class="mask"></div>
				</li>
				<li class="lottery-unit turn_7">
					<img src="images/gift2.png">
					<div class="mask"></div>
				</li>
				<li class="lottery-unit turn_8">
					<img src="images/gift2.png">
					<div class="mask"></div>
				</li>
				<li class="lottery-unit turn_0">
					<img src="images/gift2.png">
					<div class="mask"></div>
				</li>
				<li class="lottery-unit turn_1">
					<img src="images/gift2.png">
					<div class="mask"></div>
				</li>
				<li class="lottery-unit turn_2">
					<img src="images/gift2.png">
					<div class="mask"></div>
				</li>
				<li class="lottery-unit turn_3">
					<img src="images/gift2.png">
					<div class="mask"></div>
				</li>
				<li class="lottery-unit turn_4">
					<img src="images/gift2.png">
					<div class="mask"></div>
				</li>
			</ul>
		</div>
		
		<div id="change" style="text-align:center; position:absolute">
			
		</div>

		<div id="print" style="text-align:center; position:absolute">
			<ul class="div-text" ="clearfix">
				<li class="text_5">
					<br>
					<br>
					<br>
					<p style="background-color:transparent;border:0; text-align:center" >三等奖</p>
					<p style="background-color:transparent;border:0; text-align:center" >0.1</p>
				</li>
				<li class="text_6">
					<br>
					<br>
					<br>
					<p style="background-color:transparent;border:0; text-align:center" >二等奖</p>
					<p style="background-color:transparent;border:0; text-align:center" >0.1</p>
				</li>
				<li class="text_7">
					<br>
					<br>
					<br>
					<p style="background-color:transparent;border:0; text-align:center" >参与奖</p>
					<p style="background-color:transparent;border:0; text-align:center" >0.1</p>
				</li>
				<li class="text_8">
					<br>
					<br>
					<br>
					<p style="background-color:transparent;border:0; text-align:center" >未中奖</p>
					<p style="background-color:transparent;border:0; text-align:center" >0.1</p>
				</li>
				<li class="text_0">
					<br>
					<br>
					<br>
					<p style="background-color:transparent;border:0; text-align:center" >一等奖</p>
					<p style="background-color:transparent;border:0; text-align:center" >0.1</p>
				</li>
				<li class="text_1">
					<br>
					<br>
					<br>
					<p style="background-color:transparent;border:0; text-align:center" >参与奖</p>
					<p style="background-color:transparent;border:0; text-align:center" >0.1</p>
				</li>
				<li class="text_2">
					<br>
					<br>
					<br>
					<p style="background-color:transparent;border:0; text-align:center" >二等奖</p>
					<p style="background-color:transparent;border:0; text-align:center" >0.1</p>
				</li>
				<li class="text_3">
					<br>
					<br>
					<br>
					<p style="background-color:transparent;border:0; text-align:center" >三等奖</p>
					<p style="background-color:transparent;border:0; text-align:center" >0.1</p>
				</li>
				<li class="text_4">
					<br>
					<br>
					<br>
					<p style="background-color:transparent;border:0; text-align:center" >三等奖</p>
					<p style="background-color:transparent;border:0; text-align:center" >0.1</p>
				</li>
			</ul>
		</div>
	</div>
	<!-- <button style="background-color:transparent; border:0; width:200px; height:100px" id="set-button" type="button" onclick="set()" >设置</button> -->
	<script src="js/jquery.js"></script>
<script type="text/javascript">
	var click = false;
	var level = 0;
	var chance = [0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.1,0.2];
	var prizename = ["一等奖","参与奖","二等奖","三等奖","三等奖","三等奖","二等奖","参与奖","未中奖"];
	var flag = 0; // 0为设置完成状态，1为修改状态
	function set(){
		var x;
		if(flag==1){
			flag=0;
			chance[5] = parseFloat(document.getElementById("changeChance5").value);
			chance[6] = parseFloat(document.getElementById("changeChance6").value);
			chance[7] = parseFloat(document.getElementById("changeChance7").value);
			chance[8] = parseFloat(document.getElementById("changeChance8").value);
			chance[0] = parseFloat(document.getElementById("changeChance0").value);
			chance[1] = parseFloat(document.getElementById("changeChance1").value);
			chance[2] = parseFloat(document.getElementById("changeChance2").value);
			chance[3] = parseFloat(document.getElementById("changeChance3").value);
			chance[4] = parseFloat(document.getElementById("changeChance4").value);
			prizename[5] = document.getElementById("changePrize5").value;
			prizename[6] = document.getElementById("changePrize6").value;
			prizename[7] = document.getElementById("changePrize7").value;
			prizename[8] = document.getElementById("changePrize8").value;
			prizename[0] = document.getElementById("changePrize0").value;
			prizename[1] = document.getElementById("changePrize1").value;
			prizename[2] = document.getElementById("changePrize2").value;
			prizename[3] = document.getElementById("changePrize3").value;
			prizename[4] = document.getElementById("changePrize4").value;
			x=document.getElementById("set-button");  // 找到元素
			x.innerHTML="设置";    // 改变内容
			x=document.getElementById("change");
			x.innerHTML="";
			x=document.getElementById("print");
			x.innerHTML='<ul class="div-text" ="clearfix">'
				+'<li class="text_5">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+prizename[5]+'</p>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+chance[5]+'</p>'
				+'</li>'
				+'<li class="text_6">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+prizename[6]+'</p>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+chance[6]+'</p>'
				+'</li>'
				+'<li class="text_7">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+prizename[7]+'</p>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+chance[7]+'</p>'
				+'</li>'
				+'<li class="text_8">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+prizename[8]+'</p>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+chance[8]+'</p>'
				+'</li>'
				+'<li class="text_0">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+prizename[0]+'</p>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+chance[0]+'</p>'
				+'</li>'
				+'<li class="text_1">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+prizename[1]+'</p>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+chance[1]+'</p>'
				+'</li>'
				+'<li class="text_2">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+prizename[2]+'</p>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+chance[2]+'</p>'
				+'</li>'
				+'<li class="text_3">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+prizename[3]+'</p>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+chance[3]+'</p>'
				+'</li>'
				+'<li class="text_4">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+prizename[4]+'</p>'
					+'<p style="background-color:transparent;border:0; text-align:center" >'+chance[4]+'</p>'
				+'</li>'
			+'</ul>';
		}else{
			flag=1;
			x=document.getElementById("set-button");  // 找到元素
			x.innerHTML="完成";    // 改变内容
			x=document.getElementById("change");
			x.innerHTML='<ul class="div-text" ="clearfix">'
				+'<li class="text_5">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<input type="text" id="changePrize5" value="'+prizename[5]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
					+'<input type="text" id="changeChance5"value="'+chance[5]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
				+'</li>'
				+'<li class="text_6">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<input type="text" id="changePrize6" value="'+prizename[6]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
					+'<input type="text" id="changeChance6"value="'+chance[6]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
				+'</li>'
				+'<li class="text_7">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<input type="text" id="changePrize7" value="'+prizename[7]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
					+'<input type="text" id="changeChance7"value="'+chance[7]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
				+'</li>'
				+'<li class="text_8">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<input type="text" id="changePrize8" value="'+prizename[8]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
					+'<input type="text" id="changeChance8"value="'+chance[8]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
				+'</li>'
				+'<li class="text_0">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<input type="text" id="changePrize0" value="'+prizename[0]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
					+'<input type="text" id="changeChance0"value="'+chance[0]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
				+'</li>'
				+'<li class="text_1">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<input type="text" id="changePrize1" value="'+prizename[1]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
					+'<input type="text" id="changeChance1"value="'+chance[1]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
				+'</li>'
				+'<li class="text_2">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<input type="text" id="changePrize2" value="'+prizename[2]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
					+'<input type="text" id="changeChance2"value="'+chance[2]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
				+'</li>'
				+'<li class="text_3">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<input type="text" id="changePrize3" value="'+prizename[3]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
					+'<input type="text" id="changeChance3"value="'+chance[3]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
				+'</li>'
				+'<li class="text_4">'
					+'<br>'
					+'<br>'
					+'<br>'
					+'<input type="text" id="changePrize4" value="'+prizename[4]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
					+'<input type="text" id="changeChance4" value="'+chance[4]+'" style="background-color:white; text-align:center; width:208px; font-size:25px" />'
				+'</li>'
			+'</ul>';
			x=document.getElementById("print");
			x.innerHTML="";
		}
	};
	var scratchableLatex = {
		index: -1,     //当前转动到哪个位置，起点位置
		count: 0,      //总共有多少个位置
		timer: 0,      //setTimeout的ID，用clearTimeout清除
		speed: 100,    //初始转动速度
		times: 0,      //转动次数
		cycle: 50,     //转动基本次数：即至少需要转动多少次再进入抽奖环节
		prize: -1,     //中奖位置
		init: function(){
			if(flag==0) {
				this.bindEvent();
				this.lotteryInit('lottery');
			}else {
				alert("请完成设置");
				return;
			}
		},
		bindEvent: function(){
			var that = this;
			$('body').on('click', '.rand_btn', function(){         
				if (click) {
					//click控制一次抽奖过程中不能重复点击抽奖按钮，后面的点击不响应                            
					return false;
				}else{
					that.rotateFunc();  // 转圈过程不响应click事件，会将click置为false
					click = true;       // 一次抽奖完成后，设置click为true，可继续抽奖 
					return false;
				}
			})
		},
		lotteryInit: function(id) {
			if ($('#' + id).find('.lottery-unit').length > 0) {
				$lottery = $('#' + id);
				$units = $lottery.find('.lottery-unit');
				this.obj = $lottery;
				this.count = $units.length;
				$lottery.find('.turn_' + this.index).addClass('active');
			};
		},
		roll: function() {
			var index = this.index;
			var count = this.count;
			var lottery = this.obj;
			$(lottery).find('.turn_' + index).removeClass('active');
			index += 1;
			if (index > count - 1) {
				index = 0;
			};
			$(lottery).find('.turn_' + index).addClass('active');
			this.index = index;
			return false;
		},
		prizeset: function(){
			var sum = 0,factor = 0;
			var random = Math.random();
			for (var i = this.count - 1; i >= 0; i--) {
				sum += chance[i];
			};
			random *= sum;
			for (var i = this.count - 1; i >= 0; i--) {
				factor += chance[i];
				if (random <= factor)
					return i;
			};
			return null;
		},
		rotateFunc: function(){
			var that = this;
			this.times += 1;
			this.roll();
			if (this.times > this.cycle + 10 && this.prize == this.index) {
				clearTimeout(this.timer);
				setTimeout(function(){alert(prizename[level]);},500);
				console.log(level);
				this.prize = -1;
				this.times = 0;
				click = false;
			}else {
				if (this.times < this.cycle) {
					this.speed -= 10;
				}else if (this.times == this.cycle) {
					/*var index = Math.random() * (this.count) | 0; //静态演示，随机产生一个奖品序号，实际需请求接口产生*/
					var index = this.prizeset();
					this.prize = index;
					level = index;
				}else {
					if (this.times > this.cycle + 10 && ((this.prize == 0 && this.index == 7) || this.prize == this.index + 1)) {
						this.speed += 80;
					}else {
						this.speed += 20;
					}
				}
				if (this.speed < 40) {
					this.speed = 40;
				};
				this.timer = setTimeout(function(){
					that.rotateFunc()
				}, this.speed); //循环调用
			}
			return false;
		}
	}
	scratchableLatex.init();
</script>
</body>
</html>